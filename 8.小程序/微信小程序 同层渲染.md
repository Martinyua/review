一般来说有三种渲染的技术

* 使用纯客户端技术来渲染
* 使用纯WEB技术来渲染
* 使用客户端和WEB技术之间，互相结合各自的技术来渲染

## 为什么要使用Hybrid技术

如果使用纯客户端：那么小程序将会和微信一起编包，跟随微信发版本，这种开发节奏肯定不太好，如果使用存WEB方式可能在复杂的交互页面上会存在很大的性能问题。因为UI渲染线程和JS脚本的执行都是单线程互斥的。一定会导致JS执行强占UI线程

所以小程序采用的是客户端和web技术相互结合的技术**Hybrid**。**界面主要由成熟的Web技术来渲染，辅以大量的接口提供丰富的客户端原生的能力。**

## 小程序的技术问题，没有同层渲染的问题

小程序有一套组件框架-`exparse`

这个框架中有：

- 内置的一套组件
  - 涵盖**基础功能**的简单组件
  - 复杂组件是由客户端原生渲染的，以提供更好的性能，也就是**原生组件**
- 自定义组件，开发者可以拓展更多的组件，实现代码复用

原生组件是由客户端渲染，比如小程序中的`camera`、`video`、`live-player`、`canvas`、`map`、`animation-view`、`textarea`、`input`、`cover-view`、`cover-image`都是原生组件。

起初原生组件的渲染时在浏览器计算布局的时候，读取组件相对于页面的位置，在这个地方渲染一个**占位元素**。之后就在这块占位元素之上层叠了一层元素界面。**原生组件的层级比所有在WebView的元素都要高。**

#### 原生组件的作用

- 扩展web能力，比如map。input能更好的控制键盘能力
- **体验更好**，减轻webView的压力
- **绕过 setData、数据通信和重渲染流程，使渲染性能更好**。比如像画布组件 `canvas` 可直接用一套丰富的绘图接口进行绘制。

#### 存在的问题

- 元素组件**层级是最高**的。无论其他组件设置**zindex**
- **部分css样式无法设置**。无法对原生组件设置**css动画**。如果position:fixed。不能使用overflow:hidden来裁剪原生组件的显示问题

### 什么是同层渲染

就是把原生组件绘制在WebView的渲染层里面 。这样H5组件可以和原生组件任意层叠

### 浏览器渲染过程

- 生成DOM Tree
- 根据样式生成Layout Tree
- 根据LayoutTree生成图层树LayerTree。如果一个节点不存在，将不会出现在layoutTree上
- 然后在