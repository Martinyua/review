### 传输层协议的作用

* 提供了一种**端到端**的连接
* 由于网络层只管传递数据，并不关心成功与否，TCP协议在数据丢失、损坏的情况下保证**数据的可靠性**

### 传输层协议的分类

* **传输控制协议TCP**
  1. 可靠的，面向连接的协议
  2. 传输效率低
* **用户协议数据报UDP**
  1. 不可靠、无连接的协议
  2. 传输效率高

### TCP的功能

为了保证TCP是可靠的、面向连接的协议，具备以下功能：

1. 将数据进行分段**打包传输**，如果不将数据分段打包传输，那么会导致每次传输的数据特别大，而带宽是一定的，所以很容易造成拥塞。想象一下，一辆火车跑在公路上的感觉。
2. 对每个数据包**编号控制顺序**，因为数据进行了分段打包传输，而网络中的路线不止一条，而且某些路线会有延迟的情况，没有编号，那么如何保证到达的数据是原来的模样。想象一下，将一副大拼图从一个地方，分多条路运往另外一个地方，并且没有编号。
3. **运输中丢失、重发和丢弃处理**，由于网络中的路线会有延迟，并且存在丢包现象，所以会有**重发等机制**来保证数据的完整性。
4. **流量控制避免拥塞**，避免发送速率过快，让接收方来不及接收，导致发生丢包。





### 三次握手和四次挥手

![三次握手和四次挥手](https://user-gold-cdn.xitu.io/2018/9/20/165f7b595c7e7279?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

**三次握手：**



1. 第一次握手主机A通过一个**标识为`SYN标识位`**的数据段发送给**主机B请求连接**，通过该数据段告诉主机B希望建立连接，需要B应答，并告诉主机B传输的**起始序列号**
2. 第二次握手是主机B用一个**确认应答ACK**和**同步序列号SYNC**标志位的数据段来响应主机A，一是发送ACK告诉主机A收到了数据段，二是通知主机A从哪个序列号做标记。
3. 第三次握手是主机A确认收到了主机B的数据段并可以开始传输实际数据。

第一次握手主要是确定服务端确认客户端能够发送信号；第二次握手主要是客户端确认服务端能够接收和发送信号；第三次握手主要是服务端确认客户端能够接收信号



**四次挥手：**

1. 主机A发送FIN控制位发出断开连接的请求
2. 主机B进行响应，确认收到断开连接请求
3. 主机B提出反方向的关闭要求
4. 主机A确认收到的主机B的关闭连接请求

第一次挥手是服务端确认客户端需要断开连接；第二次挥手是客户端确认服务器接收断开请；第三次挥手是客户端确认服务器数据发完，断开连接；第四次挥手是服务端确认客户端断开连接，断开连接。所以如果服务端的数据全部发送完，是没有第三次挥手，直接进入第四次挥手。

