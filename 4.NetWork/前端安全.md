# CSRF 和 XSS

### 区别

* CSRF需要登录后操作，XSS不需要
* CSRF是请求页面api来实现非法操作，XSS是向页面植入js脚本来修改页面内容







### CSRF

* 第一种是GET型CSRF请求。例如再img标签中放入一个非法get请求
* 第二种是POST型CSRF请求。再POST型CSRF请求，比如构建一个表单，然后隐藏他，当用户进入页面时，就自动提交
* 第三种是链接型，利用a标签去诱导用户点击发起请求



#### 防护方法

* 第一种是**同源检测**的方法，服务器根据 http 请求头中 `origin` 或者 `referer` 信息来判断请求是否为允许访问的站点，从而对请求进行过滤。当 origin 或者 referer 信息都不存在的时候，直接阻止。

* 第二种是**使用`Token**`来进行验证。

* 第三种是在设置 `cookie` 属性的时候设置 `Samesite` ，限制 cookie 不能作为被第三方使用，从而可以避免被攻击者。 SameSite 接受下面三个值：

  `None`
  Cookie将在所有上下文中发送，**即允许跨域发送。**

  `Lax`
  Cookies允许与顶级导航一起发送，并将与第三方网站发起的GET请求一起发送。这是浏览器中的默认值。

  `Strict`
  Cookies只会在第一方上下文中发送，不会与第三方网站发起的请求一起发送。







### XSS

1. 反射性:   反射型指的是攻击者**构建了特殊的 URL**，当服务器接收到请求后，从 URL 中获取数据，**拼接到 HTML 后返回**，从而导致了恶意代码的执行。
   1. 相当于是先诱导用户点击恶意url。服务器拿到这个url后如果没有对该参数进行处理，动态拼接然后放在html里面然后传递给客户端。客户端执行的时候用户的浏览器就可以向攻击者发送令牌。然后攻击者就可以劫持用户会话。
2. 存储型:   **存储型指的是恶意代码提交到了网站的数据库中**，当用户请求数据的时候，服务器将其拼接为 **HTML 后返回给了用户**，从而导致了恶意代码的执行。
3. dom型: 通过dom修改页面内容

#### XSS会



- 获取页面数据
- 获取cookie
- 劫持前端的逻辑
- 发送请求





#### XSS防御

1. 无论是在前端和服务端，都要对用户的输入进行**转码**或者**过滤**。

2. 利用CSP建立白名单。他的核心思想是告诉浏览器，哪些资源能加载。

3. 利用HttpOnly。很多XSS都是用来窃取cookie，而设置 Cookie 的 HttpOnly 属性后，JavaScript 便无法读取 Cookie 的值

   

### CSP内容安全策略

CSP(Content-Security-Policy)内容安全策略，官方解释：CSP是一个额外的完全层，用于检测并小若某些特定类型的攻击，包括跨站**脚本攻击XSS**和数据注入攻击等。



**CSP 的实质就是白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置。**

**配置方法：**

1. 后端配置网络服务器返回Content-Security-Policy头部

2. **通过设置HTTP Header使用。**

   ```
   Content-Security-Policy
   ```

   

3. 或者前端通过<meta>标签进行配置

   

   

```
<meta http-equiv="Content-Security-Policy" content="default-src 'self';">
```

