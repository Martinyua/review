1. 通过Button的`onGetUserInfo`获取用户授权情况，如果未授权，则弹出提示提醒授权
2. 如果授权后则进入登录，调用`Taro.login(),`调用成功后获取登录凭证res.code
3. 然后调用`Taro.getUserInfo()`获取用户信息等登录需要的信息（加密信息，登录凭证）
4. 调用服务端登录接口把上面的数据发送给服务端，服务端返回`token`和`用户信息`通过 `Taro.setStorageSync()`保存
5. 更新用户头像和信息

```js
//获取用户授权
  onGetUserInfo(res){
    if (res.detail.errMsg !== 'getUserInfo:ok') {
      Taro.showModal({
        title:'⚠️警告⚠️',
        content: '如果不授权获取用户信息, 将无法正常使用该小程序!',
        showCancel:false,
        confirmText:'返回授权',
        confirmColor:'#67c241'
      });
    } else {      
      this.login()
    }
    }

  login(){
    Taro.getSetting({ //获取用户权限设置
        success:res =>{
            if (!res.authSetting['scope.userInfo']) {
                console.log('未授权')
              } else{
                Taro.login({
                  success:res =>{
                    if(res.code){
                      Taro.getUserInfo({
                        success:res2 =>{
                          const {avatarUrl,
                                 gender,
                                 nickName,
                                 city,
                                 country,
                                 province} = res2.userInfo
                          const param = {
                            avatarUrl,
                            gender,
                            nickName,
                            encryptedData: res2.encryptedData,
                            iv:res2.iv,
                            userCity:city,
                            userProvince: province,
                            userCountry:country,
                            js_code:res.code
                          }
                          this.userService.login(param).then(userRes =>							{
                            console.log('userRes',userRes)
                            const {token,
                                   avatarUrl,
                                   nickName,
                                   coinNum,
                                   gender,
                                   
                                   medal,
                                   phoneNum} = userRes;
                            const userInfo = {
                              avatarUrl,
                              nickName,
                              coinNum,
                              gender,
                              medal,
                              phoneNum
                            }
                            Taro.setStorageSync('token',token);
                            Taro.setStorageSync('userInfo',userInfo);
                            console.log('logintrue')
                            this.setState({
                              avatar:avatarUrl
                            })
                          }).finally(() => Taro.hideLoading());
                        }
                      })

                    }
                  }
                })
              }
        }
    })
  }
```

