### session

![img](https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=260083543,4284155072&fm=26&gp=0.jpg)

用户通过用户名和密码登录成功之后，服务端程序会在服务端开辟一块**Session来存储用户的信息**，同时生成一个session_id用来**标识**这个内存空间，然后通过setCookie在cookie中写入这个session_id的值。

如果下次用户再来访问的话就会带着这个cookie的session_id，服务器拿着这个id去寻找对应的session。如果找到了就表示用户已经登录了。

session保持会话信息使用起来非常简单，而且技术也比较成熟。但是也存在一些几个问题：

- 通常session是存储在内存中的，每个用户通过认证后都会将session存储在服务器**内存**中，当用户增大是，**服务器的压力也会增大。**
- session共享：现在很多应用都是分布式集群，因此我们需要额外的操作来做session共享
- CSRF跨站伪造攻击：session是基于浏览器的cookie，如果cookie被截获，用户就会很容易受到跨站伪造攻击。



### token

#### 流程：

1. 客户端使用用户名和密码登录
2. 服务端收到请求后，去验证用户名和密码，如果成功，服务端会签发一个token，在把这个token发送给客户端。
3. 客户端收到token以后可以把它存储起来，比如cookie和localStorage
4. 客户端每次发送请求都会带上这个token
5. 客户端收到请求后就去验证这个token，如果成功，就向客户端返回请求的数据。

#### 加密过程

jwt的组成：header ,payload，signature

header：声明类型jwt，声明加密的算法

payload：JSON对象，用来存放实际需要传递的数据。JWT规定了7个官方字段。还可以定义一些私有字段。

signature：通过对header 的base64。payload进行base64，然后对生成的内容使用私钥和sha256算法加密得到的值，然后再对这个值进行base64.





#### token的优点

* 服务端无须存储token，只需要验证token信息是否正确即可，而session需要在服务端存储
* 可以避免CSRF跨站伪造攻击，还是因为不依赖cookie
* 支持跨域访问，将token置于请求头中，而cookie不支持跨域访问
* 微信小程序，app不支持cookie

